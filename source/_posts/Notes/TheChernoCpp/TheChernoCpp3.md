---
title: ã€ŒThe Cherno-C++ã€å­¦ä¹ ç¬”è®°ä¸‰ï¼ˆ67-90ï¼‰
tags:
  - C/C++
  - Note
categories:
  - Notes
  - C/C++
  - TheCherno
description:
  - "TheChernoçš„C++ç³»åˆ—è§†é¢‘è¢«èª‰ä¸ºæœ€å¥½çš„C++æ•™ç¨‹ä¹‹ä¸€<br>è¿™é‡Œè®°å½•äº†æˆ‘çš„ä¸€äº›ç¬”è®°ä¸ç†è§£ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©\U0001F61D"
cover: 'https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202304182342702.png'
abbrlink: 1003
date: 2023-08-05 03:29:38
---

![cherno](https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202308050329536.jpeg)

> **Bç«™upç¥ç»å…ƒçŒ«ç¿»è¯‘ç‰ˆï¼š[https://www.bilibili.com/video/BV1uy4y167h2](https://www.bilibili.com/video/BV1uy4y167h2)**

## å‰è¨€

C++å› ä¸ºå…¶ä¼˜å¼‚çš„æ€§èƒ½ï¼Œæ˜¯æ¸¸æˆå¼€å‘ä¸­æœ€ä¸ºå¸¸ç”¨çš„è¯­è¨€ä¹‹ä¸€ï¼Œç›®å‰çš„Unityä¸Unrealä¸¤å¤§å•†ç”¨å¼•æ“çš„å†…æ ¸éƒ½æ˜¯é‡‡ç”¨C++è¿›è¡Œç¼–å†™ï¼Œä½œä¸ºä¸€ä¸ªæœ‰å¿—äºæˆä¸ºæ¸¸æˆå¼€å‘è€…çš„äººï¼Œè¿™ç§è¯­è¨€æ€ä¹ˆèƒ½ä¸å­¦ä¸€å­¦å‘¢ï¼Ÿ

æœ¬æ–‡åŸºäºæ²¹ç®¡è‘—ååšä¸»ï¼Œæ›¾ä»»èŒäºEAçš„The Chernoçš„C++ç³»åˆ—è§†é¢‘ï¼ŒThe Chernoä½œä¸ºå¯’éœœå¼•æ“çš„æ ¸å¿ƒå¼€å‘äººå‘˜ä¹‹ä¸€ï¼Œå¯¹C++æœ‰ç€éå¸¸ç‹¬åˆ°è€Œæ·±åˆ»çš„ç†è§£

è¿™äº›ç¬”è®°è®°å½•äº†æˆ‘é€šè¿‡The Chernoçš„ç³»åˆ—è§†é¢‘å­¦ä¹ C++çš„ä¸€äº›çŸ¥è¯†ç‚¹ä¸ç†è§£ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ğŸ˜‰

> ç¬¬ä¸€ç« ï¼ˆ1-33ï¼‰ï¼š[https://hmxs.games/posts/1001/](https://hmxs.games/posts/1001/)
>
> ç¬¬äºŒç« ï¼ˆ34-66ï¼‰ï¼š[https://hmxs.games/posts/1002/](https://hmxs.games/posts/1002/)
>
> **ç¬¬ä¸‰ç« ï¼ˆ67-99ï¼‰ï¼š[https://hmxs.games/posts/1003/](https://hmxs.games/posts/1003/)**

---

## è”åˆä½“ï¼ˆ67ï¼‰

> **è”åˆä½“åœ¨ä½¿ç”¨ä¸Šæœ‰ç‚¹ç±»ä¼¼ç±»æˆ–ç»“æ„ä½“ï¼Œä½†åŒºåˆ«æ˜¯ï¼ŒåŒä¸€æ—¶é—´ä¸€ä¸ªè”åˆä½“å†…åªèƒ½æœ‰ä¸€ä¸ªæˆå‘˜ï¼Œå³è”åˆä½“çš„ä¸­çš„æ‰€æœ‰æˆå‘˜éƒ½å…±ç”¨ä¸€ç‰‡å†…å­˜ç©ºé—´**

```c++
union A
{
	int a, b;
};
```

åœ¨ä¸Šé¢è¿™ä¸ªè”åˆä½“ä¸­ï¼Œå¦‚æœä½ æ”¹å˜`a`çš„å€¼ï¼Œbä¹ŸåŒæ ·ä¼šè¢«æ”¹å˜

**åœ¨ç±»å‹åŒå…³ä¸­çš„åº”ç”¨ï¼š**

`union`å¯ä»¥è¢«ç”¨æ¥æ–¹ä¾¿åœ°å®ç°ä¸Šä¸€ç« è®²åˆ°çš„ç±»å‹åŒå…³

```c++
int main()
{
	struct Union
	{
		union
		{
			float a;
			int b;
		};
	};

	Union u;
	u.b = 2;

	std::cout << u.a << "," << u.b << "\n";

	std::cin.get();
}
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­å¯¹`a`å’Œ`b`çš„èµ‹å€¼å’Œè®¿é—®ä¼šå› ä¸ºè”åˆä½“çš„ç‰¹æ€§è‡ªåŠ¨åœ°å®ç°ç±»å‹åŒå…³

```c++
struct Vector2
{
	int x, y;
};

struct Vector4
{
	union
	{
		struct
		{
			int x, y, z, w;
		};
		struct
		{
			Vector2 a, b;
		};
	};
};
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡4ä¸ª`int`æˆ–2ä¸ª`Vector2`å˜é‡æ¥è¡¨ç¤º`Vector4`ï¼Œå¹¶ä¸”æ•°æ®æ˜¯äº’é€šçš„ï¼Œè¿™ä¹Ÿæ˜¯è”åˆä½“çš„å¦™ç”¨

---

## è™šææ„å‡½æ•°ï¼ˆ68ï¼‰

> **é¡¾åæ€ä¹‰ï¼Œè™šææ„å‡½æ•°ä¾¿æ˜¯è™šå‡½æ•°å’Œææ„å‡½æ•°çš„ç»“åˆä½“ï¼Œä½†å…¶åœ¨ä¸€äº›æƒ…å†µä¸‹éå¸¸é‡è¦**

```c++
class Base
{
public:
	Base() { std::cout << "Base Constructor\n"; }
	~Base() { std::cout << "Base Destructor\n"; }
};

class Derived : public Base
{
public:
	Derived() { std::cout << "Derived Constructor\n"; }
	~Derived() { std::cout << "Derived Destructor\n"; }
};

int main()
{
	Base* base = new Base();
	delete base;
	std::cout << "--------------------\n";
	Derived* derived = new Derived();
	delete derived;
	std::cout << "--------------------\n";
	Base* test = new Derived();
	delete test;

	std::cin.get();
}

// result:
// Base Constructor
// Base Destructor
// --------------------
// Base Constructor
// Derived Constructor
// Derived Destructor
// Base Destructor
// --------------------
// Base Constructor
// Derived Constructor
// Base Destructor
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨åˆ›å»ºä¸é”€æ¯å­ç±»æ—¶ï¼Œçˆ¶ç±»çš„æ„é€ ä¸ææ„å‡½æ•°ä¼šåœ¨æœ€å¼€å§‹ä¸æœ€åè¢«è°ƒç”¨

ä½†å½“æˆ‘ä»¬é€šè¿‡çˆ¶ç±»çš„æŒ‡é’ˆè®¿é—®ä¸€ä¸ªå­ç±»å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰æ„é€ å‡½æ•°éƒ½è¢«æ­£ç¡®è°ƒç”¨äº†ï¼Œä½†ç¼ºåªæœ‰çˆ¶ç±»çš„ææ„å‡½æ•°è¢«è°ƒç”¨äº†ï¼Œå­ç±»çš„ææ„å‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²

è€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è™šææ„å‡½æ•°æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä¸æ™®é€šè™šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œè™šææ„å‡½æ•°æ‰€åšçš„å¹¶ä¸æ˜¯â€œæ›¿æ¢â€ï¼Œè€Œæ˜¯â€œåŠ ä¸Šâ€

```c++
class Base
{
public:
	Base() { std::cout << "Base Constructor\n"; }
	virtual  ~Base() { std::cout << "Base Destructor\n"; }
};
```

æˆ‘ä»¬åªéœ€è¦ä¸ºåŸºç±»çš„ææ„å‡½æ•°åŠ ä¸Š`virtual`å³å¯

> **å¦‚æœç”¨åŸºç±»æŒ‡é’ˆæ¥å¼•ç”¨æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œé‚£ä¹ˆåŸºç±»çš„ææ„å‡½æ•°å¿…é¡»æ˜¯ virtual çš„ï¼Œå¦åˆ™ C++ åªä¼šè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œä¸ä¼šè°ƒç”¨æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ã€‚**

---

## ç±»å‹è½¬æ¢ï¼ˆ69ï¼‰

> **C++ä½œä¸ºä¸€ç§å¼ºç±»å‹è¯­è¨€ï¼Œå…¶ç±»å‹çš„å­˜åœ¨æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæˆ‘ä»¬ä¸èƒ½çªå…€åœ°ç›´æ¥è½¬å˜æŸä¸€å¯¹è±¡çš„ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œæ˜¾å¼æˆ–éšå¼çš„ç±»å‹è½¬æ¢ï¼Œè€Œåœ¨C++ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Cé£æ ¼æˆ–C++é£æ ¼çš„è¯­æ³•è¿›è¡Œç±»å‹è½¬æ¢**

```c++
// éšå¼ç±»å‹è½¬æ¢
int a = 5;
double b = a;

// Cé£æ ¼æ˜¾å¼è½¬æ¢
double c = (double)a;
```

ä¸Šé¢æ˜¯éšå¼ä¸Cé£æ ¼çš„æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œå…¶è¯­æ³•éå¸¸ç®€å•ç›´è§‚

è€Œåœ¨C++ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å†…ç½®çš„ä¸€ç³»åˆ—`cast`å‡½æ•°æ¥å®ç°ç±»å‹è½¬æ¢ï¼Œä¸€å…±æœ‰4ç§ä¸»è¦çš„`cast`å‡½æ•°ï¼š`static_cast`ã€`reinterpret_cast`ã€`dynamic_cast`ã€`const_cast`

*éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`cast`å‡½æ•°å¯ä»¥å®ç°çš„åŠŸèƒ½ä½¿ç”¨Cè¯­è¨€é£æ ¼çš„ç±»å‹è½¬æ¢ä¹Ÿä¸€æ ·å¯ä»¥ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰å®ç°ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Œåªæ˜¯æ·»åŠ äº†ä¸€äº›è¯­æ³•ç³–åˆ°ä½ çš„ä»£ç ä¸­*

C++è®¾ç½®è¿™ä¹ˆå¤š`cast`çš„ç›®çš„ï¼šé™¤äº†ä¸€äº›ç¼–è¯‘æ—¶çš„é¢å¤–ç‰¹æ€§ï¼Œè¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ä»£ç åº“ä¸­å¿«é€Ÿåœ°æ‰¾åˆ°æˆ‘ä»¬åœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†ç±»å‹è½¬æ¢ï¼Œè€ŒCè¯­è¨€é£æ ¼çš„ç±»å‹è½¬æ¢åˆ™éå¸¸éš¾ä»¥å®šä½ï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬å°è¯•è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…ä¸€äº›æ„å¤–é”™è¯¯ï¼Œæ¯”å¦‚ç±»å‹ä¸å…¼å®¹

ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äº`dynamic_cast`çš„å®ä¾‹ï¼š

`dynamic_cast`åœ¨ç±»å‹è½¬æ¢æ—¶ä¼šè¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œå¦‚æœè½¬æ¢ä¸æˆåŠŸï¼Œå…¶ä¼šå°†å¯¹è±¡èµ‹å€¼ä¸ºç©º

```c++
class Base
{
public:
	Base() {}
	virtual ~Base() {}
};

class Derived1 : public Base
{
public:
	Derived1() {}
	~Derived1() {}
};

class Derived2 : public Base
{
public:
	Derived2() {}
	~Derived2() {}
};

int main()
{
    // Derived1ä¸Derived2éƒ½æ´¾ç”Ÿè‡ªBase
	Derived1* derived1 = new Derived1();

	Base* base = (Base*)derived1;

	Derived2* derived2 = dynamic_cast<Derived2*>(base);

	if (!derived2)
	{
		std::cout << "derived2 is null" << "\n";
	}

	std::cin.get();
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`dynamic_cast`è‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢æ—¶çš„å®‰å…¨æ£€æŸ¥

---

## æ¡ä»¶ä¸æ“ä½œæ–­ç‚¹ï¼ˆ70ï¼‰

> **æ¡ä»¶ä¸æ“ä½œæ–­ç‚¹å¯ä»¥è¢«åº”ç”¨ä¸æ›´åŠ å¤æ‚çš„è°ƒè¯•åœºæ™¯**
>
> **æ¡ä»¶æ–­ç‚¹å¯ä»¥è®©æ–­ç‚¹åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘**
>
> **æ“ä½œæ–­ç‚¹åˆ™å…è®¸æˆ‘ä»¬åœ¨ç¢°åˆ°æ–­ç‚¹æ—¶é‡‡å–æŸç§åŠ¨ä½œï¼Œå¦‚æ‰“å°ä¸€äº›ä¸œè¥¿åˆ°æ§åˆ¶å°**

æ¡ä»¶ä¸æ“ä½œæ–­ç‚¹çš„ä¼˜åŠ¿åœ¨äºå…¶å¯ä»¥åœ¨ä¸ç”¨æ›´æ”¹ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿è¡Œæ—¶è¿›è¡Œdebugï¼Œè¿™å¯¹æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡æœ‰å¾ˆå¤§çš„æå‡

å³å‡»æ–­ç‚¹çš„å°çº¢ç‚¹ï¼Œç‚¹å‡»æ¡ä»¶/æ“ä½œï¼Œå³å¯è°ƒå‡ºæ¡ä»¶ä¸æ“ä½œæ–­ç‚¹ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20230829014033456](https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202308290140516.png) 

> **è¿™æ˜¯ä¸€ä¸ªç®€å•è€Œååˆ†å¼ºå¤§åœ°åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨æˆ‘ä»¬éœ€è¦è°ƒè¯•ä¸€äº›è¾ƒä¸ºå¤§å‹çš„ç¨‹åºæ—¶**
>
> **ä½†åŒæ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™„åŠ è°ƒè¯•ç¨‹åºæ˜¯ååˆ†è€—è´¹æ€§èƒ½çš„**

---

## å®‰å…¨é—®é¢˜ä¸å¦‚ä½•æˆæƒï¼ˆ71ï¼‰

C++ä¸­çš„å®‰å…¨é—®é¢˜ä¸€ç›´äº‰è®®ä¸ä¼‘ï¼Œæœ‰äººè¯´æˆ‘ä»¬åº”è¯¥æ‹¥æŠ±æ™ºèƒ½æŒ‡é’ˆï¼ŒæŠ›å¼ƒåŸå§‹æŒ‡é’ˆï¼Œè€Œä¹Ÿæœ‰äººè¯´ï¼Œæ™ºèƒ½æŒ‡é’ˆæœ‰ç€ä¸¥é‡çš„å¼€é”€é—®é¢˜ï¼Œæ˜¯ç”·äººå°±ç”¨åŸå§‹æŒ‡é’ˆï¼

è€ŒChernoå¯¹æ­¤çš„æ€åº¦æ˜¯ï¼šæ²¡æœ‰ç»å¯¹çš„æ ‡å‡†ç­”æ¡ˆ

å¯¹äºç”Ÿäº§ç¯å¢ƒè€Œè¨€ï¼Œæˆ‘ä»¬ç»å¯¹åº”è¯¥ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œè¿™ä¼šå¤§å¤§é™ä½æˆ‘ä»¬å‡ºé”™çš„æ¦‚ç‡ï¼Œä¹Ÿä¼šæé«˜åä½œçš„æ•ˆç‡

å¯¹äºå­¦ä¹ å’Œäº†è§£è€Œè¨€ï¼Œä½¿ç”¨åŸå§‹æŒ‡é’ˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£æŒ‡é’ˆçš„å·¥ä½œåŸç†ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆå®é™…ä¸Šä¹Ÿåªæ˜¯åŸå§‹æŒ‡é’ˆçš„ä¸€å±‚å°è£…

å½“ç„¶ï¼Œå¦‚æœä½ éœ€è¦å®šåˆ¶çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±å†™çš„æ™ºèƒ½æŒ‡é’ˆ

---

## é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼ˆ72ï¼‰

> **é¢„ç¼–è¯‘å¤´æ–‡ä»¶å®é™…ä¸Šæ˜¯è®©ä½ æŠ“å–ä¸€å †å¤´æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºâ€œç¼–è¯‘å™¨æ ¼å¼â€ï¼Œä½¿å¾—æˆ‘ä»¬ä¸æ¯”ä¸€éåˆä¸€éåœ°è¯»å–è¿™äº›å¤´æ–‡ä»¶**

åœ¨å®é™…åœ°ä»£ç ç¼–å†™ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼š`include`ä¸€äº›å¤´æ–‡ä»¶ï¼Œè€Œæ¯å½“æˆ‘ä»¬å¯¹ç¨‹åºè¿›è¡Œä¿®æ”¹æ—¶ï¼Œè¿™äº›å¤´æ–‡ä»¶éƒ½éœ€è¦è¢«ä»å¤´å¼€å§‹é‡æ–°ç¼–è¯‘ï¼Œè¿™ä¼šå¤§å¤§æ‹–æ…¢ç¼–è¯‘çš„é€Ÿåº¦

è€Œé¢„ç¼–è¯‘å¤´æ–‡ä»¶å¯ä»¥é¢„å…ˆå°†è¿™äº›å¤´æ–‡ä»¶ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶å½¢å¼å‚¨å­˜ï¼ŒåŠ å¿«ä¹‹åç¼–è¯‘çš„é€Ÿåº¦

> **ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦è®²ä¼šç»å¸¸å˜æ›´çš„ä¸œè¥¿æ”¾å…¥é¢„ç¼–è¯‘å¤´æ–‡ä»¶ä¸­ï¼Œè¿™ä¼šé€‚å¾—å…¶åï¼Œæ˜¯æœ¬æœ«å€’ç½®çš„è¡Œä¸º**

**é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•åˆ›å»ºä¸€ä¸ªé¢„ç¼–è¯‘å¤´æ–‡ä»¶å‘¢ï¼Ÿ**

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309010210722.png" alt="image-20230901021028633" style="zoom: 67%;" />

å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è¦é¢„ç¼–è¯‘ä¸Šè¿°`pch.h`å¤´æ–‡ä»¶

åœ¨VSä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç©º`.cpp`æ–‡ä»¶ï¼Œå…¶ä¸­åªåŒ…å«éœ€è¦é¢„ç¼–è¯‘çš„å¤´æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309010212359.png" alt="image-20230901021226327" style="zoom: 67%;" />

ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥å³é”®åˆšåˆšåˆ›å»ºçš„`.cpp`æ–‡ä»¶ï¼Œç‚¹å‡»`å±æ€§->C/C++->é¢„ç¼–è¯‘å¤´`ï¼Œå°†é¢„ç¼–è¯‘å¤´é€‰é¡¹è®¾ç½®ä¸º`åˆ›å»º`

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309010214392.png" alt="image-20230901021457327" style="zoom: 50%;" />

æœ€åæˆ‘ä»¬å°†é¡¹ç›®è®¾ç½®ä¸­çš„åŒæ ·ä½ç½®çš„é¢„ç¼–è¯‘å¤´é€‰é¡¹æ”¹ä¸º`ä½¿ç”¨`ï¼Œå¹¶å°†`é¢„ç¼–è¯‘å¤´æ–‡ä»¶`æ”¹ä¸ºå¯¹åº”å¤´æ–‡ä»¶åå³å¯

> **é™¤éä½ çš„é¡¹ç›®æå…¶å°ï¼Œå¦åˆ™éƒ½åº”è¯¥ä½¿ç”¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼Œè¿™ä¼šå¤§å¤§åŠ å¿«ä½ çš„ç¼–è¯‘é€Ÿåº¦**

---

## `dynamic_cast`ï¼ˆ73ï¼‰

> **`dynamic_cast`æ˜¯åœ¨69ç« ç±»å‹è½¬æ¢ä¸­æåˆ°è¿‡çš„ä¸€ç§C++é£æ ¼çš„ç±»å‹è½¬æ¢å‡½æ•°**
>
> **å…¶ä¸“é—¨ç”¨äºæ²¿ç»§æ‰¿å±‚çº§ç»“æ„è¿›è¡Œçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªåŸºç±»å¼ºè½¬ä¸ºæ´¾ç”Ÿç±»ï¼Œæˆ–ä»æ´¾ç”Ÿç±»å¼ºè½¬ä¸ºåŸºç±»ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥ä½¿ç”¨`dynamic_cast`**

å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`Entity`åŸºç±»ï¼Œ`Player`ä¸`Enemy`ç±»éƒ½æ´¾ç”Ÿè‡ª`Entity`ï¼Œæˆ‘ä»¬æƒ³å°†ä¸€ä¸ª`Entity`å®ä¾‹å¼ºè½¬ä¸º`Player`ï¼Œä½†è¿™ä¸€å®ä¾‹ä¹Ÿæœ‰å¯èƒ½æ˜¯`Enemy`ï¼Œå¦‚æœè¿™æ—¶æˆ‘ä»¬å°è¯•å»å¯¹`Player`ç‹¬æœ‰çš„æ•°æ®è¿›è¡Œè®¿é—®å’Œæ›´æ”¹ï¼Œå°±å¾ˆå¯èƒ½ä¼šå¼•å‘é—®é¢˜ï¼Œè€Œä½¿ç”¨`dynamic_cast`è¿›è¡Œè¿™ç§ç±»å‹çš„å¼ºè½¬æ—¶ï¼Œå¦‚æœå‘ç”Ÿäº†ä¸Šè¿°æƒ…å†µï¼Œ`dynamic_cast`ä¼šä¸­æ–­è½¬æ¢å¹¶ç›´æ¥è¿”å›`Null`

```c++
class Entity
{
	virtual void Print() { }
};

class Player : public Entity
{
};

class Enemy : public Entity
{
};


int main()
{
	Player* player = new Player();

	Entity* enemy = new Enemy();
	Entity* player2 = player;

	Player* player_x = dynamic_cast<Player*>(enemy); // NULL
	Player* player_y = dynamic_cast<Player*>(player2); // Success
	std::cin.get();
}
```

### `dynamic_cast`çš„è¿è¡Œæœºåˆ¶

`dynamic_cast`å®ç°è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥æ˜¯å› ä¸ºå…¶å‚¨å­˜äº†è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼ˆRTTI:Runtime Type Informationï¼‰,å…¶å‚¨å­˜äº†æˆ‘ä»¬çš„æ‰€æœ‰ç±»å‹çš„è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼Œè¿™æ˜¾è€Œæ˜“è§åœ°ä¼šå¢åŠ å¼€é”€ï¼Œä½†å®ƒå¯ä»¥è®©ä½ å®ç°ç±»ä¼¼åŠ¨æ€ç±»å‹è½¬æ¢çš„äº‹æƒ…ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦è¿›è¡Œå–èˆ

---

## åŸºå‡†æµ‹è¯•ï¼ˆ74ï¼‰

> **åŸºå‡†æµ‹è¯•å¾€å¾€è¢«ç”¨äºæµ‹é‡ä¸€æ®µç‰¹å®šä»£ç çš„æ€§èƒ½ï¼Œæµ‹è¯•æ–¹æ³•å¤šç§å¤šæ ·ï¼Œå¦‚ä¹‹å‰å†™è¿‡çš„ä½œç”¨åŸŸè®¡æ—¶ä¾¿å¯ä»¥ç”¨äºåŸºå‡†æµ‹è¯•**

**ä½œç”¨åŸŸè®¡æ—¶å™¨ï¼š**

```c++
class Timer
{
public:
	Timer(const char* name)
		: name_(name), stopped_(false)
	{
		start_time_point_ = std::chrono::high_resolution_clock::now();
	}

	~Timer()
	{
		if (!stopped_)
			Stop();
	}

	void Stop()
	{
		end_time_point_ = std::chrono::high_resolution_clock::now();

		long long start = std::chrono::time_point_cast<std::chrono::microseconds>(start_time_point_).time_since_epoch().count();
		long long end = std::chrono::time_point_cast<std::chrono::microseconds>(end_time_point_).time_since_epoch().count();

		std::cout << name_ << ": " << (end - start) << "us(" << (end - start) * 0.001 << "ms)\n";

		stopped_ = true;
	}
private:
	const char* name_;
	bool stopped_;
	std::chrono::time_point<std::chrono::high_resolution_clock> start_time_point_, end_time_point_;
};
```

åªéœ€è¦åœ¨å¯¹åº”ä½œç”¨åŸŸåˆ›å»ºä¸€ä¸ª`Timer`å®ä¾‹å³å¯å®ç°è‡ªåŠ¨è®¡æ—¶

```c++
int main()
{
	int sum = 0;
	{
		Timer timer;
		for (int i = 0; i < 100000; ++i)
		{
			sum += 2;
		}
	}
	std::cout << sum << "\n";
	std::cin.get();
}
```

> **ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬è¿›è¡ŒåŸºå‡†æµ‹è¯•çš„ä»£ç åº”å’Œå®é™…è¿è¡Œæƒ…å†µç›¸åŒ**
>
> **å¦‚ï¼Œåœ¨VSä¸­åœ¨Debugå’ŒReleaseæ¨¡å¼ä¸‹è¿è¡Œä»£ç ä¼šæœ‰å¾ˆå¤§ä¸åŒï¼Œåœ¨Releaseæ¨¡å¼ä¸‹ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–**

**ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºå‡†æµ‹è¯•çš„å®é™…åº”ç”¨ï¼š**

ä½¿ç”¨åŸºå‡†æµ‹è¯•è¿›è¡Œä¸åŒæ™ºèƒ½æŒ‡é’ˆçš„æ€§èƒ½æµ‹è¯•

```c++
int main()
{
	struct Vector2
	{
		float x, y;
	};

	std::cout << "make_shared:\n";
	{
		std::array<std::shared_ptr<Vector2>, 2000> shared_ptr_array;
		Timer timer;
		for (auto& i : shared_ptr_array)
			i = std::make_shared<Vector2>();
	}
	std::cout << "\n";

	std::cout << "new shared:\n";
	{
		std::array<std::shared_ptr<Vector2>, 2000> shared_ptr_array;
		Timer timer;
		for (auto& i : shared_ptr_array)
			i = std::shared_ptr<Vector2>(new Vector2());
	}
	std::cout << "\n";

	std::cout << "make_unique:\n";
	{
		std::array<std::unique_ptr<Vector2>, 2000> unique_ptr_array;
		Timer timer;
		for (auto& i : unique_ptr_array)
			i = std::make_unique<Vector2>();
	}
	std::cout << "\n";


	std::cin.get();
}
```

---

## ç»“æ„åŒ–ç»‘å®šï¼ˆ75ï¼‰

> **ç»“æ„åŒ–ç»‘å®šæ˜¯C++17å¼•å…¥çš„æ–°æœºåˆ¶ï¼Œå…¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°å¤„ç†å¤šè¿”å›å€¼**

åœ¨ä¹‹å‰çš„52ç« å¦‚ä½•å¤„ç†å¤šè¿”å›å€¼æ—¶ï¼Œæœ‰è®²åˆ°å¯ä»¥ä½¿ç”¨`std::tuple`/`std::pair`æ¥è¿›è¡Œå¤„ç†ï¼Œä½†è¿™æ˜¯ä¸€ç§ä¸å¤Ÿæ¸…æ™°ï¼Œä¸”è¾ƒä¸ºç¹ççš„ä¼ å€¼æ–¹æ³•ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨å®ƒä»¬

ä½†è¿™ç§æƒ…å†µåœ¨ç»“æ„åŒ–ç»‘å®šçš„åŠ å…¥åå¾—ä»¥æ”¹å–„

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```c++
std::tuple<std::string, int> CreatePerson()
{
	return {"å¾½å¢¨è¡Œæ·±", 20 };
}
```

ä»¥ä¸Šå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œè€Œå½“æˆ‘ä»¬æƒ³è¦å¤„ç†ä¸Šè¿°å‡½æ•°çš„è¿”å›å€¼æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€åªèƒ½ä½¿ç”¨`get`å‡½æ•°æˆ–`tie`å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º

```c++
std::string name;
int age;

// ä½¿ç”¨getæå–å…ƒç»„ä¸­çš„æ•°æ®
auto person = CreatePerson();
name = std::get<0>(person);
age = std::get<1>(person);

// ä½¿ç”¨tieæå–å…ƒç»„ä¸­çš„æ•°æ®
std::tie(name, age) = CreatePerson();
```

å…¶ä¸­ä½¿ç”¨`tie`æˆ–è®¸ä¼šæ›´åŠ ç®€æ´ï¼Œä½†æ€»çš„æ¥è¯´éƒ½å¹¶ä¸æ–¹ä¾¿ï¼Œä¸å¦‚ä½¿ç”¨ç»“æ„ä½“è¿›è¡Œå¤„ç†

è€Œç»“æ„åŒ–ç»‘å®šå¤§å¹…é™ä½äº†ä»£ç çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦`tie`å’Œ`get`ï¼Œå¦‚ä¸‹æ‰€ç¤ºå³å¯å®Œæˆæ•°æ®çš„æå–

```c++
auto [name, age] = CreatePerson();
```

ç®€æ´è€Œé«˜æ•ˆï¼Œå¦‚æœæˆ‘ä»¬åªéœ€è¦å¤„ç†å°‘æ•°å‡ æ¬¡æŸä¸€å¤šç±»å‹è¿”å›å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨ç»“æ„åŒ–ç»‘å®šä¼šæˆä¸ºæˆ‘ä»¬çš„æœ€ä¼˜é€‰

> **ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤ç‰¹æ€§åªåœ¨C++17æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­æœ‰æ•ˆï¼Œåœ¨ä½¿ç”¨å‰éœ€è¦ç¡®è®¤å¥½æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬**

---

## å¦‚ä½•å¤„ç†Optionalæ•°æ®ï¼ˆ76ï¼‰

> **`std::optional`æ˜¯C++17å¼•å…¥çš„æ–°ç±»ï¼Œç”¨äºå¤„ç†é‚£äº›å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨çš„æ•°æ®ï¼Œæˆ–è€…æ˜¯ä¸€ç§æˆ‘ä»¬ä¸ç¡®å®šçš„ç±»å‹ï¼ˆæœ‰ç‚¹ç±»ä¼¼C#ä¸­çš„`ï¼Ÿ`ï¼‰**

**ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ä¾‹ï¼š**

```c++
std::string ReadFileAsString(const std::string& file_path)
{
	std::ifstream file_stream(file_path);
	if (file_stream)
	{
		std::string result;
		// read file
		file_stream.close();
		return result;
	}
	return {};
}
```

å¯¹äºä¸Šé¢è¿™ä¸ªè¯»å–æ–‡ä»¶çš„å‡½æ•°è€Œè¨€ï¼Œåœ¨ä¹‹å‰çš„C++ä¸­ï¼Œè¦åˆ¤æ–­â€œæ–‡ä»¶æ˜¯å¦è¢«æˆåŠŸè¯»å–åˆ°äº†â€æ˜¯è¾ƒä¸ºéº»çƒ¦çš„

ä¸€ä¸ªå®ç°æ–¹æ³•æ˜¯ä»å¤–éƒ¨ä¼ å…¥ä¸€ä¸ª`bool`å€¼å¼•ç”¨ï¼Œå†åœ¨å‡½æ•°å†…éƒ¨è¿›è¡Œæ”¹å˜ï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶ä¸æ˜¯å¾ˆä¼˜é›…

è€Œ`std::optional`å¯ä»¥è¾ƒä¸ºæ–¹ä¾¿åœ°è§£å†³è¿™ä¸€é—®é¢˜

```c++
std::optional<std::string> ReadFileAsString(const std::string& file_path)
```

æˆ‘ä»¬åªéœ€å°†è¿”å›å€¼åŠ ä¸Š`optional`ï¼Œä¹‹åå³å¯åœ¨å¤–éƒ¨è¿›è¡Œåˆ¤æ–­

```c++
std::optional<std::string> data = ReadFileAsString("data.txt");
if (data.has_value())
{
	// read successful
}
else
{
	// read failed
}
```

åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°æèµ·å…¶ä¸­çš„å€¼

```c++
std::string string_data;
string_data = data.value();
string_data = *data;
```

è€Œ`value_or()`å‡½æ•°å¯ä»¥è‡ªåŠ¨ä¸ºè¢«åˆ¤å®šä¸ºç©ºçš„`optional`å€¼è®¾å®šé»˜è®¤å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º

```c++
string_data = data.value_or("File Did Not Exist");
```

---

## å•ä¸€å˜é‡å­˜æ”¾å¤šç±»å‹æ•°æ®ï¼ˆ77ï¼‰

> **`std::variant`æ˜¯C++17ä¸­å¼•å…¥çš„æ–°ç±»ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨åˆ›å»ºå˜é‡æ—¶ä¸ç”¨å¤„ç†å˜é‡çš„ç¡®åˆ‡æ•°æ®ç±»å‹**

```c++
std::variant<std::string, int> data;
// èµ‹å€¼
data = "Hmxs";
data = 2;
// æå–
std::get<int>(data);
auto* value = std::get_if<std::string>(&data);

// ç”¨ä¾‹1
if (auto* value = std::get_if<std::string>(&data);)
{
	std::string* v = value;
	// do something
}
else
{
	// do something
}

// ç”¨ä¾‹2
enum ErrorCode
{
	kNone,
	kNotFound
};

std::variant<std::string, ErrorCode> ReadFile()
{
	return {};
}
```

`std::variant`ä¸`union`å¯ä»¥èµ·åˆ°çš„ä½œç”¨æœ‰äº›ç±»ä¼¼ï¼Œä»–ä»¬å„æœ‰ä¼˜åŠ£

`union`çš„å†…å­˜å¤§å°ç”±å…¶ä¸­æœ€å¤§çš„ç±»å‹å†³å®šï¼Œè€Œ`std::variant`åˆ™æ¯”è¾ƒç±»ä¼¼`class`ï¼Œå…¶å†…å­˜å¤§å°ç­‰äºä½ å£°æ˜çš„æ‰€æœ‰ç±»å‹çš„å†…å­˜æ€»å’Œï¼Œä»è¿™ä¸€è§’åº¦ä¸Šçœ‹ï¼Œ`union`çš„ç©ºé—´æ€§èƒ½æ›´å¥½

ä½†ä¸ä¹‹ç›¸å¯¹çš„`std::variant`æ‹¥æœ‰æ›´å¥½çš„å®‰å…¨æ€§ï¼Œå…¶æ˜¯ç±»å‹å®‰å…¨çš„

---

## å¦‚ä½•å‚¨å­˜ä»»æ„ç±»å‹çš„æ•°æ®ï¼ˆ78ï¼‰

> **`std::any`æ˜¯C++17ä¸­å¼•å…¥çš„æ–°ç±»ï¼Œå®ƒå¯ä»¥å‚¨å­˜ä»»æ„ç±»å‹çš„æ•°æ®**

```c++
std::any data;
// èµ‹å€¼
data = 2;
data = "Hmxs";
// æå–
// å¦‚æœå½“å‰dataæ•°æ®ç±»å‹ä¸any_castæƒ³è¦è½¬æ¢çš„ä¸ä¸€è‡´ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸
std::any_cast<std::string>(data);
```

æ­£å¦‚`any`çš„åå­—ä¸€æ ·ï¼Œ`std::any`å¯ä»¥å­˜å‚¨æ‰€æœ‰ç±»å‹ï¼Œè¿™çœ‹èµ·æ¥ä¾¿äºç¼–å†™ï¼Œä¼šæ¯”ä¸Šä¸€ç« è®²åˆ°çš„`std::variant`æ–¹ä¾¿å¾ˆå¤šï¼Œä½†è¿™å¹¶ä¸ä¸€å®šæ˜¯ä¼˜ç‚¹,`any`çš„ä»»æ„å±æ€§ä¼šç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤šæ„æ–™ä¹‹å¤–çš„éº»çƒ¦

```c++
std::any data;
data = "Hmxs";
std::string value = std::any_cast<std::string>(data);
```

å¦‚ä¸Šé¢è¿™æ®µä»£ç ï¼Œçœ‹èµ·æ¥ååˆ†åˆç†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿è¡Œåˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºå­—é¢é‡`"Hmxs"`çš„ç±»å‹å®é™…ä¸Šæ˜¯`const char[5]`ï¼Œè€Œæˆ‘ä»¬å°†å…¶çœ‹åšäº†`std::string`ï¼Œ`any_cast`å¹¶ä¸ä¼šå¸®æˆ‘ä»¬è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œä½†å·®ä¸å¤šçš„ä»£ç ä½¿ç”¨`std::variant`åˆ™å®Œå…¨ä¸ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå…¶æ˜¯ç±»å‹å®‰å…¨çš„

è€Œé™¤æ­¤ä¹‹å¤–ï¼Œ`std::any`è¿˜å­˜åœ¨ä¸€å®šç¨‹åº¦çš„å†…å­˜é—®é¢˜ï¼Œå½“æˆ‘ä»¬å°†`any`ç±»å‹çš„å˜é‡èµ‹å€¼ä¸ºå†…å­˜è¾ƒå°çš„ç±»å‹å¦‚`int`ã€`float`æ—¶ï¼Œå…¶è¿è¡Œæœºåˆ¶ä¸`variant`å‡ ä¹ä¸€æ ·ï¼Œä½†å½“æˆ‘ä»¬å°†å…¶å®šä¹‰ä¸ºè¾ƒå¤§çš„ç±»å‹æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨åœ°è¿›è¡ŒåŠ¨æ€å†…å­˜åˆ†é…ï¼Œè€Œå¯¹æ€§èƒ½å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹

> **æ€»è€Œè¨€ä¹‹ï¼Œå°±ç›®å‰è€Œè¨€`any`å‡ ä¹æ²¡æœ‰æ¯”è¾ƒå¥½çš„åº”ç”¨åœºæ™¯ï¼Œè€Œä¸ºäº†æˆ‘ä»¬çš„C++ç¨‹åºèƒ½æ›´å¥½åœ°è·‘èµ·æ¥ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…ä½¿ç”¨å®ƒ**

---

## å¦‚ä½•è®©C++è¿è¡Œåœ°æ›´å¿«ï¼ˆ79ï¼‰

ç°ä»£ç¡¬ä»¶å¾€å¾€æ˜¯å¯ä»¥è¿›è¡Œå¹¶è¡Œè¿ç®—çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨åŒä¸€æ—¶é—´å¹¶è¡Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥å¤§å¹…æé«˜ç¨‹åºè¿è¡Œçš„é€Ÿåº¦ï¼Œä½†å¤šçº¿ç¨‹å¸¦æ¥çš„ç¨‹åºè°ƒåº¦é—®é¢˜ä¹Ÿæ˜¯ååˆ†å¤æ‚çš„

> **åœ¨C++11ä¸­ï¼Œ`std::async`è¢«å¼•å…¥å¸®åŠ©æˆ‘ä»¬å®ç°ç¨‹åºçš„å¤šçº¿ç¨‹åŒ–**

---

## å¦‚ä½•è®©å­—ç¬¦ä¸²æ›´å¿«ï¼ˆ80ï¼‰

> **C++çš„å­—ç¬¦ä¸²å®é™…ä¸Šéå¸¸æ…¢ï¼Œè€Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›äº‹æƒ…è®©å®ƒä»¬èƒ½è¢«æ›´å¿«åœ°å¤„ç†**

`std::string`çš„ä¸»è¦é—®é¢˜ä¹‹ä¸€ï¼Œå¯èƒ½å°±æ˜¯å­—ç¬¦ä¸²æ ¼å¼åŒ–ä»¥åŠå­—ç¬¦ä¸²æ“ä½œï¼Œå› ä¸ºå®ƒä»¬éƒ½éœ€è¦è¿›è¡Œå†…å­˜åˆ†é…

ä¸‹é¢çš„ä»£ç é€šè¿‡é‡è½½`new`è¿ç®—ç¬¦çš„æ–¹å¼æ­ç¤ºäº†å…¶ä¼šè¿›è¡Œçš„å†…å­˜åˆ†é…

```c++
static uint32_t count = 0;

void* operator new(size_t size)
{
	count++;
	std::cout << "allocating:" << size << "bytes\n";
	return malloc(size);
}

void PrintName(const std::string& name)
{
	std::cout << name << "\n";
}

int main()
{
	std::string name = "hmxs's Cpp";
	PrintName(name);
	std::cout << count << "allocations\n";
	std::cin.get();
}
// output:
// allocating:16bytes
// hmxs's Cpp
// 1allocations
```

è¿è¡Œåæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`std::string`è°ƒç”¨äº†`new`è¿›è¡Œäº†1æ¬¡å†…å­˜åˆ†é…

åŒæ—¶ä½¿ç”¨`substr()`è¿™ç±»å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œçš„å‡½æ•°ä¹Ÿä¼šè¿›è¡Œå†…å­˜åˆ†é…

è€Œè§£å†³å®ƒä»¬çš„æ–¹æ³•ä¾¿æ˜¯C++17ä¸­å¼•å…¥çš„`std::string_view`æˆ–è‡ªå·±å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŒ…è£…

> **`std::string_view`æ˜¯ä¸€ä¸ªæŒ‡å‘ç°æœ‰å­—ç¬¦ä¸²å†…å­˜çš„æŒ‡é’ˆï¼Œå…¶å°±åƒä¸€ä¸ªè§‚å¯Ÿå­—ç¬¦ä¸²çš„çª—å£ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬ä¾¿å¯ä»¥å‡å°‘è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œæ—¶å‘ç”Ÿçš„å†…å­˜åˆ†é…**

```c++
std::string name = "hmxs";
std::string_view sub_name1(name.c_str(), 2);
std::string_view sub_name2(name.c_str() + 2, 2);
```

è¿™æ ·ä¸€æ¥å†…å­˜åˆ†é…ä¾¿è¢«å‡å°‘äº†

è€Œä¸ä½¿ç”¨`std::string`ä½¿ç”¨`const char*`åˆ™å¯ä»¥å®Œå…¨ä¸éœ€è¦å†…å­˜åˆ†é…

---

## å¯è§†åŒ–åŸºå‡†æµ‹è¯•ï¼ˆ81ï¼‰

åœ¨ä¹‹å‰çš„ç¬¬74ç« `åŸºå‡†æµ‹è¯•`ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ä½¿ç”¨`Timer`ç±»ä¸æ§åˆ¶å°è¿›è¡Œè¾“å‡ºçš„åŸºå‡†æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º

```c++
void Function1()
{
	Timer timer("Function1");

	for (int i = 0; i < 1000; ++i)
		std::cout << "Hello #" << i << "\n";
}

void Function2()
{
	Timer timer("Function2");

	for (int i = 0; i < 1000; ++i)
		std::cout << "Hello #" << sqrt(i) << "\n";
}
```

åªéœ€è¦åœ¨å¯¹åº”ä½œç”¨åŸŸå†…å£°æ˜`Timer`å˜é‡å³å¯

ä½†è¿™ç§æ–¹æ³•æœ‰æ—¶æ¯”è¾ƒéº»çƒ¦ï¼Œåœ¨å¤§é‡æ§åˆ¶å°è¾“å‡ºä¸­å¯»æ‰¾é‚£ä¸ªåŸºå‡†æµ‹è¯•æ•°æ®å¹¶ä¸æ˜¯ä»€ä¹ˆå¾ˆå¥½çš„ä½“éªŒ

è¿™æ—¶å€™å¯è§†åŒ–å°±å¯ä»¥å‡ºåœºäº†ï¼Œè€Œæˆ‘ä»¬å°†ä½¿ç”¨`Edge`/`Chrome`è¿›è¡Œå¯è§†åŒ–åŸºå‡†æµ‹è¯•

æˆ‘ä»¬åªéœ€è¦åœ¨æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥`edge://tracing`ï¼ˆ`Chrome`åˆ™ä¸º`chrome://tracing`ï¼‰å³å¯è¿›å…¥å¯è§†åŒ–é¡µé¢

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309200023131.png" alt="image-20230920002356933" style="zoom: 33%;" />

è¿™ä¸ªé¡µé¢æ¥å—ä¸€ä¸ª`.json`æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„ä¾¿æ˜¯è¾“å‡ºä¸€ä¸ªç¬¦åˆè¦æ±‚çš„`json`æ–‡ä»¶

ä½¿ç”¨æµè¾“å‡ºä»£ç æ ¹æ®è§„å®šæ ¼å¼è¾“å‡ºå³å¯è·å¾—jsonæ–‡ä»¶ï¼Œ`cherno`ä¸ºæˆ‘ä»¬ç¼–å†™äº†æµè¾“å‡ºç¨‹åº[https://gist.github.com/TheCherno/31f135eea6ee729ab5f26a6908eb3a5e](https://gist.github.com/TheCherno/31f135eea6ee729ab5f26a6908eb3a5e)

```c++
void Function1()
{
	InstrumentationTimer timer("Function1");

	for (int i = 0; i < 1000; ++i)
		std::cout << "Hello #" << i << "\n";
}

void Function2()
{
	InstrumentationTimer timer("Function2");

	for (int i = 0; i < 1000; ++i)
		std::cout << "Hello #" << sqrt(i) << "\n";
}

int main()
{
	Instrumentor::Get().BeginSession("Profile");
	Function1();
	Function2();
	Instrumentor::Get().EndSession();
	std::cin.get();
}
```

å¦‚æ­¤æˆ‘ä»¬ä¾¿å¾—åˆ°äº†å¯ä»¥ä½¿ç”¨çš„`json`æ–‡ä»¶ï¼Œå°†å…¶æ‹–å…¥ä¸Šè¿°ç½‘ç«™å³å¯è·å¾—å¯è§†åŒ–ç»“æœ

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309200114877.png" alt="image-20230920011456750" style="zoom:33%;" />

---

## å•ä¾‹æ¨¡å¼ï¼ˆ82ï¼‰

å•ä¾‹æ¨¡å¼åœ¨C#ä¸Javaä¸­ä¼šç»å¸¸è¢«æåˆ°ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸åŸºç¡€çš„è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¿è¯äº†æŸä¸€ç±»åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¸”å¯ä»¥è¢«å…¨å±€è°ƒç”¨

è€Œåœ¨C++ä¸­ï¼Œå› ä¸ºC++çš„çµæ´»æ€§ï¼Œå…¶å®æˆ‘ä»¬å¹¶ä¸éœ€è¦ä½¿ç”¨ç±»æ¥ç»„ç»‡ä¸€åˆ‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡/å‡½æ•°å°±èƒ½å®ç°å•ä¾‹çš„æ•ˆæœï¼Œé‚£ä¹ˆå•ä¾‹åœ¨C++ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨æ›´åŠ çµæ´»çš„çœ¼å…‰çœ‹å¾…C++ä¸­çš„å•ä¾‹

> **C++ä¸­çš„å•ä¾‹åªæ˜¯ä¸€ç§ç»„ç»‡ä¸€å †å…¨å±€å˜é‡å’Œé™æ€å‡½æ•°çš„æ–¹å¼ï¼Œå¯ä»¥èµ·åˆ°ç±»ä¼¼å‘½åç©ºé—´çš„æ•ˆæœ**

### C++å•ä¾‹çš„åŸºç¡€å®ç°

```c++
class Singleton
{
public:
	// åˆ é™¤æ‹·è´æ„é€ å‡½æ•°
	Singleton(const Singleton&) = delete;

	static Singleton& Instance()
	{
		return instance_;
	}

private:
	// ç§æœ‰æ„é€ å‡½æ•°
	Singleton() {}

	static Singleton instance_;
};

Singleton Singleton::instance_;
```

ä¸Šè¿°å®ç°éœ€è¦åœ¨å¤–éƒ¨å£°æ˜`instance`ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ç®€åŒ–ä»£ç 

```c++
class Singleton
{
public:
	Singleton(const Singleton&) = delete;

	static Singleton& Instance()
	{
		static Singleton instance;
		return instance;
	}

private:
	Singleton() {}
};
```

> **å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨å‘½åç©ºé—´å¯ä»¥è¾¾åˆ°å·®ä¸å¤šçš„æ•ˆæœï¼ˆé™¤äº†ä¸èƒ½èµ‹å€¼ä»¥å¤–ï¼‰ï¼Œè€Œä½¿ç”¨ç±»æ¥å¯¹ä»£ç è¿›è¡Œç»„ç»‡æˆ–è®¸ä¼šæ›´åŠ æœ‰æ¡ç†**

---

## å°å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆ83ï¼‰

> **C++å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²çš„æ…¢ä¼—æ‰€å‘¨çŸ¥ï¼Œå› ä¸ºå…¶æ€»æ˜¯å€¾å‘äºå»è¿›è¡Œå †å†…å­˜çš„åˆ†é…ï¼›ä½†è¿™å¹¶ä¸ç»å¯¹ï¼Œå½“æˆ‘ä»¬å®šä¹‰çš„å­—ç¬¦ä¸²å°äºä¸€å®šé•¿åº¦æ—¶ï¼Œå…¶ä¾¿ä¸ä¼šè¿›è¡Œå †å†…å­˜çš„åˆ†é…äº†**

åœ¨VS19ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯15ï¼Œå³å½“æˆ‘ä»¬å®šä¹‰çš„å­—ç¬¦ä¸²å°äºç­‰äº15ä¸ªå­—ç¬¦æ—¶ï¼Œå…¶ä¾¿ä¸ä¼šè¿›è¡Œå†…å­˜åˆ†é…äº†

---

## è·Ÿè¸ªå†…å­˜åˆ†é…çš„ç®€å•æ–¹æ³•ï¼ˆ84ï¼‰

> **å†…å­˜æ€»æ˜¯ç¨‹åºçš„é‡ä¸­ä¹‹é‡ï¼Œæˆ–è®¸åœ¨å½“ä»£è®¡ç®—æœºç¡¬ä»¶çš„é«˜é€Ÿå‘å±•ä¸‹ï¼Œå†…å­˜çš„ä½¿ç”¨å·²ä¸å†é‚£ä¹ˆæ‰è¥Ÿè§è‚˜ï¼Œä½†å¯¹äºå†…å­˜ä½¿ç”¨ä»æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„**

æˆ‘ä»¬å¯ä»¥å¯¹å…¨å±€çš„`new`ä¸`delete`æ“ä½œç¬¦è¿›è¡Œé‡è½½+æ–­ç‚¹+æ£€æŸ¥å†…å­˜å †æ ˆçš„å½¢å¼ç®€å•åœ°æ£€æŸ¥æ¯ä¸€å¤„å†…å­˜åˆ†é…ä¸é‡Šæ”¾çš„åœ°æ–¹

```c++
void* operator new(size_t size)
{
	std::cout << "allocating" << size << "bytes\n";	

	return malloc(size);
}

void operator delete(void* memory, size_t size)
{
	std::cout << "freeing" << size << "bytes\n";	

	free(memory);
}
```

<img src="https://hmxs-1315810738.cos.ap-shanghai.myqcloud.com/img/202309210133729.png" alt="image-20230921013310633" style="zoom: 80%;" />

æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨å±€çš„å†…å­˜è®°å½•å™¨æ¥è®°å½•æ‰€æœ‰åˆ†é…çš„å†…å­˜å¤§å°

```c++
struct AllocationMetrics
{
	uint32_t total_allocated = 0;
	uint32_t total_freed = 0;

	uint32_t CurrentUsage() { return total_allocated - total_freed; }
};

static AllocationMetrics allocation_metrics;

void* operator new(size_t size)
{
	allocation_metrics.total_allocated += size;

	return malloc(size);
}

void operator delete(void* memory, size_t size)
{
	allocation_metrics.total_freed += size;

	free(memory);
}
```

---

## å·¦å€¼ä¸å³å€¼ï¼ˆ85ï¼‰

> **å·¦å€¼åŸºæœ¬ä¸Šæ˜¯å…·æœ‰å­˜å‚¨å±æ€§çš„å¯¹è±¡ï¼Œå…¶å…·æœ‰åœ°å€å’Œå€¼ï¼Œå¯ä»¥å‡ºç°åœ¨`=`çš„å·¦å³ä¸¤è¾¹**
>
> **å³å€¼åŸºæœ¬ä¸Šæ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œå¦‚å­—é¢é‡ä¸è¡¨è¾¾å¼ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹åªèƒ½å‡ºç°åœ¨`=`çš„å³è¾¹ï¼Œä¸èƒ½è¢«èµ‹å€¼**
>
> **å·¦å€¼å¼•ç”¨ï¼Œå¦‚`std::string&`ï¼Œåªèƒ½æ¥å—å·¦å€¼ï¼Œé™¤éåŠ ä¸Š`const`**
>
> **å³å€¼å¼•ç”¨ï¼Œå¦‚`std::sting&&`ï¼Œåªèƒ½æ¥å—å³å€¼**

å·¦å€¼å³å€¼çš„å®šä¹‰å¤æ‚ï¼Œå¾ˆéš¾ä¸€è¨€ä»¥è”½ä¹‹ï¼Œçº ç»“äºå®šä¹‰åè€Œå®¹æ˜“é™·å…¥è¯¯åŒºï¼Œæ›´å¥½çš„åšæ³•æ˜¯åœ¨ä¾‹å­ä¸­è¿›è¡Œç†è§£

```c++
// è¿”å›å€¼ä¸ºint&ç±»å‹ï¼Œæ˜¯å·¦å€¼å¼•ç”¨ï¼Œæ‰€ä»¥åªèƒ½è¿”å›å·¦å€¼ï¼Œå³å¿…é¡»æ˜¯å…·æœ‰å­˜å‚¨ç©ºé—´ï¼Œä¸èƒ½æ˜¯ä¸´æ—¶å˜é‡
// æ¥å—çš„å‚æ•°ä¸ºstring&ç±»å‹ï¼Œæ˜¯å·¦å€¼å¼•ç”¨ï¼Œæ‰€ä»¥æ¥å—çš„å‚æ•°ä¹Ÿå¿…é¡»æ˜¯å·¦å€¼ï¼Œç›´æ¥Print("Hmxs")ä¼šæŠ¥é”™
int& Print(std::string& name)
{
	static int value = 1;
	return value;
}

int main()
{
	std::string s = "Hmxs";
	Print(s);
}
```

```c++
std::string name1 = "wzh";
std::string name2 = "hmxs";
std::string name3 = name1 + name2;
// name1ï¼Œname2ï¼Œname3æ˜¯å·¦å€¼
// "wzh"ï¼Œ"hmxs"ï¼Œname1+name2æ˜¯å³å€¼
```

```c++
// å‚æ•°ä¸ºå³å€¼å¼•ç”¨ï¼Œåªèƒ½ä¼ å…¥å³å€¼ï¼Œä¼ å…¥å·¦å€¼ä¼šæŠ¥é”™ï¼Œå³Print(name)ä¼šæŠ¥é”™
void Print(std::string&& name) { }

int main()
{
	Print("wzh");
}
```

> **å·¦å€¼å³å€¼åœ¨è¿›è¡Œä¼˜åŒ–ä¸ç§»åŠ¨è¯­ä¹‰æ—¶å¾ˆæœ‰ç”¨ï¼Œå…¶ä¹Ÿä¸€å®šç¨‹åº¦ååº”äº†C++çš„è¿è¡Œæœºç†**

---

## æŒç»­é›†æˆï¼ˆ86ï¼‰

> **æŒç»­é›†æˆï¼ˆCIï¼‰é€šå¸¸æŒ‡çš„æ˜¯åœ¨å¼€å‘æœŸé—´æŒç»­é›†æˆä»£ç çš„è¿‡ç¨‹ï¼Œå…¶æœ¬è´¨æ˜¯æ„å»ºè‡ªåŠ¨åŒ–å’Œæµ‹è¯•**
>
> **åœ¨å¤šäººåä½œå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¤šåå¼€å‘è€…åœ¨ä¸€èµ·è´¡çŒ®ä»£ç çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¸ä¼šåœ¨æ‰€æœ‰å¹³å°è¿›è¡Œæµ‹è¯•ï¼Œæœ‰äº›åªåœ¨ç‰¹å®šå¹³å°ä¼šå‡ºç°çš„bugæœ‰å¯èƒ½å°±ä¸ä¼šè¢«å‘ç°ï¼Œè€Œè¦æ±‚æ‰€æœ‰å¼€å‘è€…ä¸ºæ‰€æœ‰å¹³å°è¿›è¡Œæµ‹è¯•æˆæœ¬è¿‡äºå·¨å¤§ï¼Œè€ŒæŒç»­é›†æˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åŒ–æ•´ä¸ªè¿‡ç¨‹ï¼Œç¡®ä¿ä»£ç åœ¨æ‰€æœ‰å¹³å°å’Œæ‰€æœ‰é…ç½®ä¸‹éƒ½å¯ä»¥ç¼–è¯‘**

åœ¨è¿™é›†ä¸­Chernoæ¨èäº†Jenkinsæ¥å®ç°æŒç»­é›†æˆ

ç›®å‰è¿™å—å†…å®¹å¯¹æˆ‘æ¥è¯´å¹¶æ²¡æœ‰å¾ˆå¤§ä½œç”¨ï¼Œæ‰€ä»¥è¿™ç« å…ˆè·³è¿‡

---

## é™æ€åˆ†æï¼ˆ87ï¼‰

> **é™æ€åˆ†æï¼ˆStatic Analysisï¼‰æ˜¯ä»£ç çš„æ£€æŸ¥åˆ†æå™¨ï¼Œå¤šä¸€åŒçœ¼ç›æ£€æŸ¥ä½ çš„ä»£ç æ€»æ²¡åå¤„**

å…¶ä¸­Chernoæ¨èäº†pvs studioï¼Œä½†å…¶ä¸­æœ‰å•†ä¸šæ¨å¹¿çš„è¦ç´ 

ç”±äºä¸æƒ³é¢å¤–èŠ±é’±æ‰€ä»¥è¿™ç« ä¹Ÿå…ˆè·³è¿‡

é™æ€åˆ†æå·¥å…·å¤šç§å¤šæ ·ï¼Œå…¶ä¸­ä¹Ÿä¸ä¹å¼€æºå…è´¹çš„å·¥å…·

---

## å‚æ•°è®¡ç®—é¡ºåºï¼ˆ88ï¼‰

```c++
void Print(int a, int b)
{
	std::cout << a << " + " << b << " = " << (a + b) << "\n";
}

int main()
{
	int value = 0;
	Print(value++, value++);

	std::cin.get();
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæœ€åä¼šè¾“å‡ºä»€ä¹ˆå®é™…ä¸Šæ˜¯ä¸ç¡®å®šçš„ï¼Œå³`æœªå®šä¹‰è¡Œä¸º`

> **C++å¹¶æ²¡æœ‰æä¾›å‚æ•°è®¡ç®—é¡ºåºçš„è§„èŒƒï¼Œæ‰€ä»¥è®¡ç®—é¡ºåºå®Œå…¨æ ¹æ®ç¼–è¯‘å™¨çš„å®ç°ä¸C++çš„ç‰ˆæœ¬å†³å®šï¼Œç”šè‡³ä¸åŒçš„è¿è¡Œæ¨¡å¼ä¹Ÿä¼šå½±å“è¾“å‡ºçš„ç»“æœ**
>
> **æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å†™å‡ºè¿™æ ·ä»¤äººç–‘æƒ‘çš„ä»£ç **

---

## ç§»åŠ¨è¯­ä¹‰ï¼ˆ89ï¼‰

> **åœ¨C++11ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªå¯¹è±¡ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è·å¾—å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œæˆ‘ä»¬é™¤äº†æ‹·è´åˆ«æ— é€‰æ‹©ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å½“å‰å †æ ˆå¸§ä¸­æ„é€ ä¸€ä¸ªä¸€æ¬¡æ€§å¯¹è±¡ï¼Œç„¶åå°†å®ƒå¤åˆ¶åˆ°æˆ‘æ­£åœ¨è°ƒç”¨çš„å‡½æ•°ä¸­**
>
> **è¿™å¹¶ä¸ç†æƒ³ï¼Œå¦‚æœæˆ‘ä»¬çš„å¯¹è±¡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè¿™ä¸€è¿‡ç¨‹å°†å˜å¾—å¾ˆæ…¢ï¼Œè€Œè¿™æ—¶ç§»åŠ¨è¯­ä¹‰ä¾¿å‡ºç°äº†ï¼Œå…¶å…è®¸æˆ‘ä»¬ç§»åŠ¨å¯¹è±¡è€Œä¸æ˜¯å¤åˆ¶å®ƒï¼Œä»¥æ­¤æ¥æé«˜æ€§èƒ½**

```c++
class String
{
public:
	String() = default;

	// æ„é€ å‡½æ•°
	String(const char* string)
	{
		printf("Created\n");
		size_ = strlen(string);
		data_ = new char[size_];
		memcpy(data_, string, size_);
	}

	// å¤åˆ¶æ„é€ å‡½æ•°
	String(const String& other)
	{
		printf("Coped\n");
		size_ = other.size_;
		data_ = new char[size_];
		memcpy(data_, other.data_, size_);
	}

	~String()
	{
		delete data_;
	}

	void Print()
	{
		for (uint32_t i = 0; i < size_; i++)
			printf("%c", data_[i]);
		printf("\n");
	}
private:
	char* data_;
	uint32_t size_;
};

class Entity
{
public:
	Entity(const String& name)
		: name_(name)
	{
	}

	void PrintName()
	{
		name_.Print();
	}
private:
	String name_;
};

int main()
{
	Entity entity(String("Hmxs"));
	entity.PrintName();

	std::cin.get();
}

// result:
// Created
// Coped
// Hmxs
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œé‚£ä¹ˆå¤åˆ¶å¯¹è±¡å‡ ä¹æ— æ³•é¿å…

ä½†æˆ‘ä»¬å¿…é¡»å¤åˆ¶å¯¹è±¡åœ¨è¿™ä¸€æƒ…æ™¯ä¸‹å…¶å®ç†åº”æ˜¯è’è°¬çš„ï¼Œæˆ‘ä»¬çš„éœ€æ±‚ä¸º`å°†ä¸€ä¸ªStringå¯¹è±¡æ”¾å…¥Entityä¸­`ï¼Œä½†æˆ‘ä»¬éœ€è¦åšçš„å´æ˜¯`å…ˆåœ¨å¤–éƒ¨åˆ›å»ºä¸€ä¸ªStringå¯¹è±¡ï¼Œå†å°†å…¶æ·±æ‹·è´åˆ°Entityçš„Stringä¸­`ï¼Œä¸ºå•¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†å¤–éƒ¨åˆ›å»ºçš„`String`ç›´æ¥ç§»åŠ¨åˆ°`Entity`ä¸­å‘¢ï¼Ÿè€Œä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œæˆ‘ä»¬ä¾¿å¾—ä»¥åšåˆ°è¿™ç‚¹

ç§»åŠ¨è¯­ä¹‰å®è´¨ä¸Šä¾¿æ˜¯å°†æ·±æ‹·è´å˜ä¸ºæµ…æ‹·è´ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œé€šè¿‡å³å€¼å¼•ç”¨å°†å¯¹è±¡å¼ºè¡Œæ ‡è®°ä¸ºå³å€¼ï¼Œå³ä¸´æ—¶å¯¹è±¡ï¼Œåé€šè¿‡`std::move`ä½¿æˆ‘ä»¬åœ¨æ‹·è´æ—¶è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œè€Œéå¤åˆ¶æ„é€ å‡½æ•°

```c++
class String
{
public:
	String() = default;

	// æ„é€ å‡½æ•°
	String(const char* string)
	{
		printf("Created\n");
		size_ = strlen(string);
		data_ = new char[size_];
		memcpy(data_, string, size_);
	}

	// å¤åˆ¶æ„é€ å‡½æ•°
	String(const String& other)
	{
		printf("Coped\n");
		size_ = other.size_;
		data_ = new char[size_];
		memcpy(data_, other.data_, size_);
	}

	// ç§»åŠ¨æ„é€ å‡½æ•°
	String(String&& other)
	{
		printf("Moved\n");
		size_ = other.size_;
		data_ = other.data_;

		// å¤„ç†åŸå…ˆçš„å¯¹è±¡
		other.size_ = 0;
		other.data_ = nullptr;
	}

	~String()
	{
		printf("Destroyed\n");
		delete data_;
	}

	void Print()
	{
		for (uint32_t i = 0; i < size_; i++)
			printf("%c", data_[i]);
		printf("\n");
	}
private:
	char* data_;
	uint32_t size_;
};

class Entity
{
public:
	Entity(const String& name)
		: name_(name)
	{
	}

	Entity(String&& name)
		: name_(std::move(name)) // å¿…é¡»ä½¿ç”¨std::moveï¼Œå¦åˆ™ä»ç„¶ä¼šå¤åˆ¶ï¼Œå› ä¸ºå³å€¼å¼•ç”¨åœ¨è¿›å…¥å‡½æ•°ä½“åä¼šå˜æˆå·¦å€¼ï¼Œæ‰€ä»¥è¦è§¦å‘ç§»åŠ¨è¯­ä¹‰å¿…é¡»è®©ä»–å˜ä¸ºå³å€¼å¼•ç”¨
	{
	}

	void PrintName()
	{
		name_.Print();
	}
private:
	String name_;
};

int main()
{
	Entity entity(String("Hmxs"));
	entity.PrintName();

	std::cin.get();
}

// result:
// Created
// Moved
// Destroyed
// Hmxs
```

é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬ä¾¿æˆåŠŸé¿å…äº†å¤šä½™çš„å¤åˆ¶ï¼Œå…¶ä¸­`Entity entity(String("Hmxs"));`å…·ä½“çš„é€»è¾‘æ˜¯ï¼š

1. é¦–å…ˆ`String("Hmxs")`ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„`String`å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡ä¼ å…¥`entity`çš„æ„é€ å‡½æ•°ä¸­
2. å› ä¸ºä¼ å…¥çš„`String`å¯¹è±¡æ˜¯å³å€¼ï¼Œæ‰€ä»¥ä¼šä¼˜å…ˆè¿›å…¥`Entity(String&& name)`è¿™ä¸€å‚æ•°ä¸ºå³å€¼å¼•ç”¨ï¼Œå¹¶æ‰§è¡Œ`name_(std::move(name))`çš„åˆå§‹åŒ–è¿‡ç¨‹

*ä½œä¸ºå³å€¼å¼•ç”¨è¢«ä¼ å…¥çš„`String`å¯¹è±¡åœ¨è¿›å…¥å‡½æ•°åå˜ä¸ºäº†å·¦å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨`std::move`å°†å…¶å¼ºè½¬ä¸ºå³å€¼å¼•ç”¨ï¼Œæ‰èƒ½è¿›å…¥`String`çš„ç§»åŠ¨æ„é€ å‡½æ•°*

3. ä¹‹åä¾¿è¿›å…¥äº†`String`çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸­ï¼Œå°†`entity`ä¸­çš„`name_`æŒ‡å‘ä¸´æ—¶çš„`String`å¯¹è±¡ï¼Œä¹‹åå°†ä¸´æ—¶çš„`String`å¯¹è±¡ç½®ç©ºï¼Œå³å®Œæˆäº†ç§»åŠ¨è¿‡ç¨‹

*å› ä¸ºä¸´æ—¶çš„`String`å¯¹è±¡æ˜¯å³å€¼ï¼Œä¸”è¢«ç½®ç©ºï¼Œåœ¨è¯­å¥ç»“æŸåä¼šè‡ªåŠ¨åœ°è¿›è¡Œé‡Šæ”¾*

è‡³æ­¤ï¼Œæˆ‘ä»¬ä¾¿å®Œæˆäº†ä¸€æ¬¡æˆåŠŸçš„ç§»åŠ¨è¯­ä¹‰ï¼Œcool

---

## `std::move`ä¸ç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦ï¼ˆ90ï¼‰

> **`std::move`å†…éƒ¨çš„å®ç°æ˜¯ä¸€ä¸ª`static_cast`ï¼Œå…¶ä¼šå°†ä¼ å…¥å¯¹è±¡çš„ç±»å‹å¼ºè½¬ä¸ºå¯¹åº”ç±»å‹çš„å³å€¼å¼•ç”¨å½¢å¼**
>
> **`std::move`æ˜¯ä¸€ä¸ªä¼˜é›…çš„å®ç°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¼ å…¥å³å€¼å¼•ç”¨å‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨å®ƒ**

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç¼–å†™`ç§»åŠ¨æ„é€ å‡½æ•°`å®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œè€Œæ­£å¦‚å…¶åå­—ä¸­çš„`æ„é€ `æ‰€è¨€ï¼Œå…¶æ˜¯ä¸€ç§ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œåªæœ‰åœ¨å¯¹è±¡æ„é€ æ—¶æ‰ä¼šè¢«è°ƒç”¨

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰å‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥ä½¿ç”¨`ç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦`

```c++
class String
{
public:
	String() = default;

	// ç§»åŠ¨æ„é€ å‡½æ•°
	String(String&& other)
	{
		printf("Moved\n");
		size_ = other.size_;
		data_ = other.data_;

		// å¤„ç†åŸå…ˆçš„å¯¹è±¡
		other.size_ = 0;
		other.data_ = nullptr;
	}

	// ç§»åŠ¨èµ‹å€¼æ“ä½œ
	String& operator=(String&& other)
	{
		printf("Assigned\n");

		// å¦‚æœå°è¯•ç»™è‡ªå·±ç§»åŠ¨å‘è‡ªå·±ï¼Œåº”è¯¥ç›´æ¥è¿”å›
		if (this == &other)
			return *this;

		// ç§»åŠ¨èµ‹å€¼æ“ä½œä¼šä½œç”¨äºä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆé‡Šæ”¾åŸå…ˆçš„å¯¹è±¡
		delete[] data_;

		size_ = other.size_;
		data_ = other.data_;

		// å¤„ç†åŸå…ˆçš„å¯¹è±¡
		other.size_ = 0;
		other.data_ = nullptr;

		return *this;
	}

	~String()
	{
		printf("Destroyed\n");
		delete data_;
	}
private:
	char* data_;
	uint32_t size_;
};
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åº”è¯¥æ³¨æ„åˆ†è¾¨`ç§»åŠ¨æ„é€ `ä¸`ç§»åŠ¨èµ‹å€¼`ï¼Œå› ä¸ºéšå¼è½¬æ¢çš„ç¼˜æ•…ï¼Œæœ‰æ—¶æ„é€ å‡½æ•°å¾ˆå®¹æ˜“å’Œèµ‹å€¼ç›¸æ··æ·†

---

## åè®°

`ã€The Cherno C++ã€‘`ç³»åˆ—æš‚æ—¶å®Œç»“å•¦ï¼Œåç»­çš„91-99å› ä¸ºéƒ½æ¯”è¾ƒé•¿ä¸”ä¸æ˜¯æˆ‘ç°åœ¨éœ€è¦çš„çŸ¥è¯†å°±å…ˆæš‚æ—¶æç½®å•¦ï¼Œåç»­å†æ›´æ–°å§

ä¸€ç‚¹ç‚¹è·Ÿå®Œäº†90ç« çš„å†…å®¹ï¼Œåªèƒ½è¯´å—ç›ŠåŒªæµ…

æ„Ÿè°¢[The Cherno](https://www.youtube.com/@TheCherno)çš„ç²¾å“æ•™ç¨‹ï¼Œä¹Ÿæ„Ÿè°¢upä¸»[ç¥ç»å…ƒçŒ«](https://space.bilibili.com/364152971)<u>çš„æ— å¿ç¿»è¯‘</u>
